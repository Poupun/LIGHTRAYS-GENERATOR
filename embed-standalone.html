<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Rays Embed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100vw;
            height: 100vh;
            background: #000;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }

        #light-rays-embed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 1;
        }

        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            text-align: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ff6b6b;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00ff7f;
            text-align: center;
            font-size: 14px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 127, 0.3);
            border-top: 3px solid #00ff7f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="light-rays-embed">
        <div class="loading">
            <div class="spinner"></div>
            Loading light rays...
        </div>
    </div>

    <script>
        /**
         * Light Rays Engine - Standalone Embed Version
         * Optimized for iframe embedding
         */
        class LightRaysEngine {
            constructor(container, config = {}) {
                this.container = typeof container === 'string' ? document.querySelector(container) : container;
                if (!this.container) {
                    throw new Error('Container element not found');
                }

                // Default configuration
                this.config = {
                    color: '#00ff7f',
                    intensity: 0.6,
                    rayCount: 12,
                    rayWidth: 80,
                    rayHeight: 120,
                    lightX: 100,
                    lightY: 0,
                    animationSpeed1: 1,
                    animationSpeed2: 1,
                    animated: true,
                    blurEnabled: true,
                    ...config
                };

                this.rayContainer = null;
                this.init();
            }

            init() {
                this.createRayContainer();
                this.generateRays();
            }

            createRayContainer() {
                if (this.rayContainer) {
                    this.rayContainer.remove();
                }

                this.rayContainer = document.createElement('div');
                this.rayContainer.className = 'light-rays-container';
                this.rayContainer.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    overflow: hidden;
                    pointer-events: none;
                    z-index: 1;
                `;

                this.container.style.position = 'relative';
                this.container.appendChild(this.rayContainer);
                this.applyCSSVariables();
            }

            applyCSSVariables() {
                const rgb = this.hexToRgb(this.config.color);
                
                this.rayContainer.style.setProperty('--primary-color', this.config.color);
                this.rayContainer.style.setProperty('--ray-r', rgb.r.toString());
                this.rayContainer.style.setProperty('--ray-g', rgb.g.toString());
                this.rayContainer.style.setProperty('--ray-b', rgb.b.toString());
                this.rayContainer.style.setProperty('--intensity', this.config.intensity.toString());
                this.rayContainer.style.setProperty('--light-x', this.config.lightX + '%');
                this.rayContainer.style.setProperty('--light-y', this.config.lightY + '%');
                this.rayContainer.style.setProperty('--ray-width', this.config.rayWidth + 'px');
                this.rayContainer.style.setProperty('--ray-height', this.config.rayHeight + 'vh');
                this.rayContainer.style.setProperty('--animation-speed1', this.config.animationSpeed1.toString());
                this.rayContainer.style.setProperty('--animation-speed2', this.config.animationSpeed2.toString());
            }

            hexToRgb(hex) {
                const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : { r: 0, g: 255, b: 127 };
            }

            createStyleSheet() {
                if (document.getElementById('light-rays-styles-embed')) return;
                
                const style = document.createElement('style');
                style.id = 'light-rays-styles-embed';
                style.textContent = `
                    .light-rays-ambient {
                        position: absolute;
                        top: var(--light-y);
                        left: var(--light-x);
                        width: 200%;
                        height: 200%;
                        background: conic-gradient(
                            from 225deg at center,
                            transparent 0deg,
                            rgba(var(--ray-r), var(--ray-g), var(--ray-b), calc(var(--intensity) * 0.3)) 45deg,
                            rgba(var(--ray-r), var(--ray-g), var(--ray-b), calc(var(--intensity) * 0.1)) 90deg,
                            transparent 135deg
                        );
                        transform: translate(-50%, -50%);
                        opacity: var(--intensity);
                        ${this.config.animated ? 'animation: lr-gentle-pulse calc(8s / var(--animation-speed1)) ease-in-out infinite alternate;' : ''}
                        ${this.config.blurEnabled ? 'filter: blur(60px);' : 'filter: blur(20px);'}
                    }

                    .light-rays-ray {
                        position: absolute;
                        top: var(--light-y);
                        left: var(--light-x);
                        width: var(--ray-width);
                        height: var(--ray-height);
                        transform-origin: 50% 0%;
                        transform: translate(-50%, -50%) rotate(var(--angle));
                        opacity: calc(var(--opacity) * var(--intensity));
                        ${this.config.blurEnabled ? `
                            background: radial-gradient(
                                ellipse calc(var(--ray-width) / 2) var(--ray-height) at center 0%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 1) 0%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.9) 8%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.7) 20%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.5) 35%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.3) 50%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.2) 65%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.1) 80%,
                                transparent 100%
                            );
                            filter: blur(calc(var(--ray-width) / 12)) saturate(1.2);
                        ` : `
                            background: linear-gradient(
                                to bottom,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 1) 0%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.9) 15%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.6) 30%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.4) 50%,
                                rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.2) 70%,
                                transparent 100%
                            );
                            clip-path: polygon(45% 0%, 55% 0%, 100% 100%, 0% 100%);
                        `}
                    }

                    .light-rays-ray.layer1 {
                        ${this.config.animated ? 'animation: lr-ray-combined calc(var(--shimmer-duration) / var(--animation-speed1)) ease-in-out infinite;' : ''}
                        animation-delay: var(--delay);
                    }

                    .light-rays-ray.layer2 {
                        ${this.config.animated ? 'animation: lr-ray-combined-2 calc(var(--shimmer-duration) / var(--animation-speed2)) ease-in-out infinite;' : ''}
                        animation-delay: calc(var(--delay) + 1.5s);
                    }

                    .light-rays-central {
                        position: absolute;
                        top: calc(var(--light-y) - 100px);
                        left: calc(var(--light-x) - 100px);
                        width: 200px;
                        height: 200px;
                        background: radial-gradient(
                            circle,
                            rgba(var(--ray-r), var(--ray-g), var(--ray-b), 1) 0%,
                            rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.8) 20%,
                            rgba(var(--ray-r), var(--ray-g), var(--ray-b), 0.4) 40%,
                            transparent 70%
                        );
                        border-radius: 50%;
                        opacity: calc(var(--intensity) * 0.8);
                        ${this.config.animated ? 'animation: lr-central-glow-pulse 6s ease-in-out infinite alternate;' : ''}
                        ${this.config.blurEnabled ? 'filter: blur(30px);' : 'filter: blur(10px);'}
                    }

                    @keyframes lr-ray-combined {
                        0% { 
                            opacity: calc(var(--opacity) * var(--intensity) * 0.8); 
                            transform: translate(-50%, -50%) rotate(var(--angle)) scaleY(0.98); 
                        }
                        25% {
                            opacity: calc(var(--opacity) * var(--intensity) * 1.0);
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) + var(--sway-angle) * 0.5)) scaleY(1.02);
                        }
                        50% { 
                            opacity: calc(var(--opacity) * var(--intensity) * 1.1); 
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) + var(--sway-angle))) scaleY(1.05); 
                        }
                        75% {
                            opacity: calc(var(--opacity) * var(--intensity) * 1.0);
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) + var(--sway-angle) * 0.5)) scaleY(1.02);
                        }
                        100% { 
                            opacity: calc(var(--opacity) * var(--intensity) * 0.9); 
                            transform: translate(-50%, -50%) rotate(var(--angle)) scaleY(0.99); 
                        }
                    }

                    @keyframes lr-ray-combined-2 {
                        0% { 
                            opacity: calc(var(--opacity) * var(--intensity) * 0.7); 
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) - var(--sway-angle) * 0.3)) scaleY(0.96); 
                        }
                        25% {
                            opacity: calc(var(--opacity) * var(--intensity) * 0.9);
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) + var(--sway-angle) * 0.2)) scaleY(1.02);
                        }
                        50% { 
                            opacity: calc(var(--opacity) * var(--intensity) * 1.0); 
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) + var(--sway-angle) * 0.7)) scaleY(1.08); 
                        }
                        75% {
                            opacity: calc(var(--opacity) * var(--intensity) * 0.9);
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) + var(--sway-angle) * 0.2)) scaleY(1.02);
                        }
                        100% { 
                            opacity: calc(var(--opacity) * var(--intensity) * 0.8); 
                            transform: translate(-50%, -50%) rotate(calc(var(--angle) - var(--sway-angle) * 0.3)) scaleY(1.01); 
                        }
                    }

                    @keyframes lr-gentle-pulse {
                        0% { opacity: calc(var(--intensity) * 0.6); transform: translate(-50%, -50%) scale(0.95); }
                        50% { opacity: calc(var(--intensity) * 0.9); transform: translate(-50%, -50%) scale(1.05); }
                        100% { opacity: calc(var(--intensity) * 0.7); transform: translate(-50%, -50%) scale(0.98); }
                    }

                    @keyframes lr-central-glow-pulse {
                        0% { opacity: calc(var(--intensity) * 0.8); transform: scale(0.9); }
                        50% { opacity: calc(var(--intensity) * 1.2); transform: scale(1.1); }
                        100% { opacity: calc(var(--intensity) * 0.9); transform: scale(0.95); }
                    }
                `;
                document.head.appendChild(style);
            }

            generateRays() {
                this.rayContainer.innerHTML = '';
                this.createStyleSheet();

                // Create ambient light
                const ambientLight = document.createElement('div');
                ambientLight.className = 'light-rays-ambient';
                this.rayContainer.appendChild(ambientLight);

                // Generate Layer 1 rays
                this.generateRayLayer(1, this.config.rayCount, 0, 1, 1.5, 1, 1);
                
                // Generate Layer 2 rays
                this.generateRayLayer(2, Math.floor(this.config.rayCount * 0.7), 15, 0.8, 1.2, 0.9, 0.8);

                // Create central glow
                const centralGlow = document.createElement('div');
                centralGlow.className = 'light-rays-central';
                this.rayContainer.appendChild(centralGlow);
            }

            generateRayLayer(layer, count, angleOffset, sizeMultiplier, softMultiplier, heightMultiplier, opacityMultiplier) {
                for (let i = 0; i < count; i++) {
                    // Gentler angle variation
                    const baseAngle = (360 / count) * i + angleOffset;
                    const angle = baseAngle + (Math.random() - 0.5) * 4; // Random Â±2 degree variation
                    
                    // Smoother delay patterns
                    const baseDelay = i * (layer === 1 ? 0.1 : 0.15) + (layer === 2 ? 0.5 : 0);
                    const delay = baseDelay + Math.random() * 0.2; // Less random delay
                    
                    // More varied opacity
                    const baseOpacity = (0.4 + (Math.random() * 0.5)) * opacityMultiplier;
                    
                    // Subtler size variations
                    const sizeVariation = 0.85 + Math.random() * 0.3; // 85-115% size variation
                    const heightVariation = 0.9 + Math.random() * 0.2; // 90-110% height variation

                    this.createRay({
                        angle, delay, opacity: baseOpacity,
                        width: this.config.rayWidth * sizeMultiplier * sizeVariation,
                        height: this.config.rayHeight * heightMultiplier * heightVariation,
                        layer, type: 'main',
                        randomSeed: Math.random() // For unique animation variations
                    });
                }
            }

            createRay({ angle, delay, opacity, width, height, layer, type, randomSeed }) {
                const ray = document.createElement('div');
                ray.className = `light-rays-ray layer${layer}`;
                ray.style.setProperty('--angle', angle + 'deg');
                ray.style.setProperty('--delay', delay + 's');
                ray.style.setProperty('--opacity', opacity.toString());
                
                // Slower, smoother animation properties
                const shimmerDuration = (6 + Math.random() * 4); // 6-10s variation
                const swayDuration = (12 + Math.random() * 8); // 12-20s variation
                const swayAngle = (1 + Math.random() * 2); // 1-3 degree sway variation
                
                ray.style.setProperty('--shimmer-duration', shimmerDuration + 's');
                ray.style.setProperty('--sway-duration', swayDuration + 's');
                ray.style.setProperty('--sway-angle', swayAngle + 'deg');
                ray.style.setProperty('--random-seed', (randomSeed || Math.random()).toString());
                
                // Less frequent animation direction changes
                if (Math.random() < 0.15) {
                    ray.style.animationDirection = 'reverse';
                }
                
                this.rayContainer.appendChild(ray);
            }
        }

        // Initialize the embed
        (function() {
            try {
                // Get configuration from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const configParam = urlParams.get('config');
                
                let config = {};
                if (configParam) {
                    try {
                        config = JSON.parse(decodeURIComponent(configParam));
                    } catch (e) {
                        console.warn('Failed to parse config parameter:', e);
                    }
                }

                // Remove loading indicator
                const loading = document.querySelector('.loading');
                if (loading) {
                    loading.remove();
                }

                // Initialize light rays
                new LightRaysEngine('#light-rays-embed', config);

                // Notify parent window that embed is ready
                if (window.parent !== window) {
                    window.parent.postMessage({ type: 'light-rays-ready' }, '*');
                }

            } catch (error) {
                console.error('Light rays embed error:', error);
                
                // Show error message
                const container = document.getElementById('light-rays-embed');
                container.innerHTML = `
                    <div class="error-message">
                        <h3>Failed to load light rays</h3>
                        <p>${error.message}</p>
                    </div>
                `;

                // Notify parent of error
                if (window.parent !== window) {
                    window.parent.postMessage({ 
                        type: 'light-rays-error', 
                        error: error.message 
                    }, '*');
                }
            }
        })();
    </script>
</body>
</html>